!function(){"use strict";var t,e=(function(t){!function(e){var n,r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag",c=e.regeneratorRuntime;if(c)t.exports=c;else{(c=e.regeneratorRuntime=t.exports).wrap=w;var h="suspendedStart",l="suspendedYield",f="executing",d="completed",p={},v={};v[o]=function(){return this};var E=Object.getPrototypeOf,m=E&&E(E(I([])));m&&m!==r&&i.call(m,o)&&(v=m);var y=b.prototype=x.prototype=Object.create(v);k.prototype=y.constructor=b,b.constructor=k,b[u]=k.displayName="GeneratorFunction",c.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===k||"GeneratorFunction"===(e.displayName||e.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u in t||(t[u]="GeneratorFunction")),t.prototype=Object.create(y),t},c.awrap=function(t){return{__await:t}},T(R.prototype),R.prototype[s]=function(){return this},c.AsyncIterator=R,c.async=function(t,e,n,r){var i=new R(w(t,e,n,r));return c.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},T(y),y[u]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},c.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=I,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,i){return s.type="throw",s.arg=t,e.next=r,i&&(e.method="next",e.arg=n),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:I(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=n),p}}}function w(t,e,n,r){var i=e&&e.prototype instanceof x?e:x,a=Object.create(i.prototype),o=new O(r||[]);return a._invoke=function(t,e,n){var r=h;return function(i,a){if(r===f)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw a;return N()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=L(o,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var u=g(t,e,n);if("normal"===u.type){if(r=n.done?d:l,u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(t,n,o),a}function g(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function x(){}function k(){}function b(){}function T(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function R(t){var e;this._invoke=function(n,r){function a(){return new Promise(function(e,a){!function e(n,r,a,o){var s=g(t[n],t,r);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,a,o)},function(t){e("throw",t,a,o)}):Promise.resolve(c).then(function(t){u.value=t,a(u)},o)}o(s.arg)}(n,r,e,a)})}return e=e?e.then(a,a):a()}}function L(t,e){var r=t.iterator[e.method];if(r===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=n,L(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=g(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,p):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(i.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=n,e.done=!0,e};return a.next=a}}return{next:N}}function N(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())}(t={exports:{}},t.exports),t.exports),n=function(){return this}()||Function("return this")(),r=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=r&&n.regeneratorRuntime;n.regeneratorRuntime=void 0;var a=e;if(r)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}var o=a,s=function(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function r(i,a){try{var o=e[i](a),s=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)});t(s)}("next")})}},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(t){return Array.isArray(t)?t:Array.from(t)},f=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};function d(){}var p,v=document.getElementById.bind(document),E=(document.getElementsByClassName.bind(document),document.getElementsByTagName.bind(document),URL?function(t){return new URL(t,document.location).href}:function(t){var e=document.createElement("a");return e.href=t,e.href}),m="loading"===document.readyState?(p="DOMContentLoaded",new Promise(function(t){return addEventListener(p,t)})):Promise.resolve(),y=function(t,e){return Math.floor(Math.random()*Math.floor(e))+t},w=(function(){function t(e){u(this,t),this._seed=e%2147483647,this._seed<=0&&(this._seed+=2147483646)}c(t,[{key:"next",value:function(){return this._seed=16807*this._seed%2147483647}},{key:"nextFloat",value:function(){return(this.next()-1)/2147483646}}])}(),Object.create(null));function g(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"config.js";return(t=E(t))in w?Promise.resolve(w[t]):new Promise(function(e,n){var r=document.createElement("script");r.onload=function(){e(w[r.src]),r.remove()},r.onerror=function(){n(),r.remove()},document.head.appendChild(r),r.src=t})}function x(t,e,n){this.x=t,this.y=e,this.z=n}window.config=function(t){w[document.currentScript.src]=Object.freeze(t)},x.prototype.dot2=function(t,e){return this.x*t+this.y*e},x.prototype.dot3=function(t,e,n){return this.x*t+this.y*e+this.z*n};var k=[new x(1,1,0),new x(-1,1,0),new x(1,-1,0),new x(-1,-1,0),new x(1,0,1),new x(-1,0,1),new x(1,0,-1),new x(-1,0,-1),new x(0,1,1),new x(0,-1,1),new x(0,1,-1),new x(0,-1,-1)],b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],T=new Array(512),R=new Array(512);function L(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var n;n=1&e?b[e]^255&t:b[e]^t>>8&255,T[e]=T[e+256]=n,R[e]=R[e+256]=k[n%12]}}L(0);var S=.5*(Math.sqrt(3)-1),A=(3-Math.sqrt(3))/6;function O(t,e){var n,r,i=(t+e)*S,a=Math.floor(t+i),o=Math.floor(e+i),s=(a+o)*A,u=t-a+s,c=e-o+s;u>c?(n=1,r=0):(n=0,r=1);var h=u-n+A,l=c-r+A,f=u-1+2*A,d=c-1+2*A,p=R[(a&=255)+T[o&=255]],v=R[a+n+T[o+r]],E=R[a+1+T[o+1]],m=.5-u*u-c*c,y=.5-h*h-l*l,w=.5-f*f-d*d;return 70*((m<0?0:(m*=m)*m*p.dot2(u,c))+(y<0?0:(y*=y)*y*v.dot2(h,l))+(w<0?0:(w*=w)*w*E.dot2(f,d)))}var I,N,P=(I=s(o.mark(function t(){return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m;case 2:Y=document.getElementById("world-canvas"),(Z=Y.getContext("2d")).mozImageSmoothingEnabled=!1,Z.webkitImageSmoothingEnabled=!1,Z.msImageSmoothingEnabled=!1,Z.imageSmoothingEnabled=!1;case 8:case"end":return t.stop()}},t,this)})),function(){return I.apply(this,arguments)}),M=(N=s(o.mark(function t(e){var n,r,i,a,s,u,c,l,f,d,p,v,E,m,y,w,x,k,b,T;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.tile_theme+"/",r=(e.player_theme||e.tile_theme)+"/",t.next=4,Promise.all([n+"theme.js",r+"theme.js",C+"theme.js"].map(g));case 4:for(i=t.sent,a=h(i,3),s=a[0],u=a[1],c=a[2],l=Object.assign({},_,s),q=l.tile_width,j=l.tile_depth,F=l.block_height,W=l.tile_gap,z=l.tile_gap_z,Q=l.noise_amplifier,K=u.player_height||l.player_height,f=!0,d=!1,p=void 0,t.prev=20,v=U[Symbol.iterator]();!(f=(E=v.next()).done);f=!0)m=E.value,u.sprites.hasOwnProperty(m)?B[m]=nt(m,u,r):s.sprites.hasOwnProperty(m)?B[m]=nt(m,s,n):B[m]=nt(m,c,C);t.next=28;break;case 24:t.prev=24,t.t0=t.catch(20),d=!0,p=t.t0;case 28:t.prev=28,t.prev=29,!f&&v.return&&v.return();case 31:if(t.prev=31,!d){t.next=34;break}throw p;case 34:return t.finish(31);case 35:return t.finish(28);case 36:for(y=!0,w=!1,x=void 0,t.prev=39,k=D[Symbol.iterator]();!(y=(b=k.next()).done);y=!0)T=b.value,s.sprites.hasOwnProperty(T)?B[T]=nt(T,s,n):B[T]=nt(T,c,C);t.next=47;break;case 43:t.prev=43,t.t1=t.catch(39),w=!0,x=t.t1;case 47:t.prev=47,t.prev=48,!y&&k.return&&k.return();case 50:if(t.prev=50,!w){t.next=53;break}throw x;case 53:return t.finish(50);case 54:return t.finish(47);case 55:return t.abrupt("return",Promise.all(Object.values(B).map(function(t){return t.load()})));case 56:case"end":return t.stop()}},t,this,[[20,24,28,36],[29,,31,35],[39,43,47,55],[48,,50,54]])})),function(t){return N.apply(this,arguments)}),C="img/simple/",_={tile_width:64,tile_depth:32,block_height:16,player_height:128,tile_gap:2,tile_gap_z:1,noise_amplifier:1},H=["south","east","north","west"],U=H.map(function(t){return"player_"+t}),D=["floor","block","mark","cuboid"],B={},G=Object.create(null),q=void 0,j=void 0,F=void 0,W=void 0,z=void 0,Q=void 0,K=void 0,Y=void 0,Z=void 0,J=!0,V=!0;function X(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];J=t}function $(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];V=t}var tt,et=(tt=s(o.mark(function t(){return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Promise,t.t1=M,t.next=4,g();case 4:return t.t2=t.sent,t.t3=(0,t.t1)(t.t2),t.t4=P(),t.t5=[t.t3,t.t4],t.next=10,t.t0.all.call(t.t0,t.t5);case 10:case"end":return t.stop()}},t,this)})),function(){return tt.apply(this,arguments)});function nt(t,e,n){var r=void 0,i=void 0;try{var a=l(e.images[e.sprites[t]]);r=a[0],i=a.slice(1)}catch(e){return void console.warn("Bad theme config: No image for sprite '"+t+"' in "+n)}return i.length?new(Function.prototype.bind.apply(it,[null].concat([n+r],f(i)))):new rt(n+r)}var rt=function(){function t(e){u(this,t),this.imagePath=e}return c(t,[{key:"load",value:function(){var t=s(o.mark(function t(){var e;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,at(this.imagePath);case 2:this._image=t.sent,e=q/this._image.width,this._scaledWidth=q,this._scaledHeight=e*this._image.height,this.height=this._scaledHeight-j;case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"draw",value:function(t,e,n){t.drawImage(this._image,e,n-this.height,this._scaledWidth,this._scaledHeight)}}]),t}(),it=function(){function t(e,n,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;u(this,t),this.imagePath=e,this._crop={x:n,y:r,width:i,height:a};var c=q/i;this._scaledWidth=q,this._scaledHeight=c*a,this.height=this._scaledHeight-j,this.xOffset=o,this.yOffset=s}return c(t,[{key:"load",value:function(){var t=s(o.mark(function t(){return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,at(this.imagePath);case 2:this._image=t.sent;case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"draw",value:function(t,e,n){t.drawImage(this._image,this._crop.x,this._crop.y,this._crop.width,this._crop.height,e+this.xOffset,n-this.height-this.yOffset,this._scaledWidth,this._scaledHeight)}}]),t}();function at(t){return t in G?G[t]:G[t]=new Promise(function(e){var n=new Image;n.onload=function(){e(n)},n.src=t})}var ot=function(){function t(e,n,r,i,a,o){u(this,t),this.width=e,this.length=n,this.height=r,this.seed=i||y(1<<31,-(1<<31)),this.player=a||{x:0,y:0,orientation:0},this.tiles=o||Array.from({length:e*n},function(){return{blocks:0,mark:!1}})}return c(t,[{key:"contains",value:function(t,e){return t>=0&&e>=0&&t<this.width&&e<this.length}},{key:"isLookingAtEdge",value:function(){return!this.contains.apply(this,f(t.move(this.player)))}},{key:"step",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.tiles[this.player.x*this.length+this.player.y].blocks,i=t.move(this.player,e,n),a=h(i,2),o=a[0],s=a[1];if(!this.contains(o,s))throw new Error("invalid move: out of world");var u=this.tiles[o*this.length+s];if(1<Math.abs(r-u.blocks))throw new Error("invalid move: jump too high");if(u.cuboid)throw new Error("invalid move: cuboid");var c=[o,s];this.player.x=c[0],this.player.y=c[1]}},{key:"stepBackwards",value:function(){this.step(-1)}},{key:"turnLeft",value:function(){this.player.orientation=(this.player.orientation+1)%4}},{key:"turnRight",value:function(){this.player.orientation=(this.player.orientation+3)%4}},{key:"placeBlock",value:function(){var e=t.move(this.player),n=h(e,2),r=n[0],i=n[1];if(!this.contains(r,i))throw new Error("invalid action: out of world");var a=this.tiles[r*this.length+i];if(a.cuboid)throw new Error("invalid action: block on cuboid");if(a.blocks>=this.height)throw new Error("invalid action: building too high");a.blocks++}},{key:"takeBlock",value:function(){var e=t.move(this.player),n=h(e,2),r=n[0],i=n[1];if(!this.contains(r,i))throw new Error("invalid action: out of world");var a=this.tiles[r*this.length+i];if(a.blocks<=0)throw new Error("invalid action: no blocks");a.blocks--}},{key:"placeMark",value:function(){var t=this.tiles[this.player.x*this.length+this.player.y];if(t.mark)throw new Error("invalid action: already has a mark");t.mark=!0}},{key:"takeMark",value:function(){var t=this.tiles[this.player.x*this.length+this.player.y];if(!t.mark)throw new Error("invalid action: no mark");t.mark=!1}}],[{key:"move",value:function(t){var e=t.x,n=t.y,r=t.orientation,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(r){case 0:e+=a,n+=i;break;case 1:e+=i,n+=a;break;case 2:e-=a,n-=i;break;case 3:e-=i,n-=a}return[e,n]}}]),t}(),st="NOT",ut="IF",ct="WHILE",ht=Object.freeze({IDENTIFIER:"IDENTIFIER",INTEGER:"INTEGER",NOT:st,IF:ut,THEN:"THEN",ELSE:"ELSE",WHILE:ct,DO:"DO",REPEAT:"REPEAT",TIMES:"TIMES",PROGRAM:"PROGRAM",ROUTINE:"ROUTINE",LPAREN:"LPAREN",RPAREN:"RPAREN",LBRACKET:"LBRACKET",RBRACKET:"RBRACKET",LBRACE:"LBRACE",RBRACE:"RBRACE",LESS:"LESS",GREATER:"GREATER",EQUALS:"EQUALS",ASTERISC:"ASTERISC",SLASH:"SLASH",HYPHENMINUS:"HYPHENMINUS",PLUS:"PLUS",DOT:"DOT",COMMA:"COMMA",COLON:"COLON",SEMI:"SEMI",SINGLEQUOTE:"SINGLEQUOTE",DOUBLEQUOTE:"DOUBLEQUOTE",WHITESPACE:"WHITESPACE",COMMENT:"COMMENT",EOF:"EOF"}),lt=function(){function t(e,n,r,i){u(this,t),this.type=e,this.value=n,this.line=r,this.column=i}return c(t,[{key:"toString",value:function(){return this.type+"("+this.value+")"}}]),t}(),ft={wenn:ut,if:ut,dann:"THEN",then:"THEN",sonst:"ELSE",else:"ELSE",solange:ct,while:ct,tue:"DO",do:"DO",nicht:st,not:st,wiederhole:"REPEAT",repeat:"REPEAT",mal:"TIMES",times:"TIMES",programm:"PROGRAM",program:"PROGRAM",anweisung:"ROUTINE",routine:"ROUTINE"},dt={"(":"LPAREN",")":"RPAREN","[":"LBRACKET","]":"RBRACKET","{":"LBRACE","}":"RBRACE","<":"LESS",">":"GREATER","=":"EQUALS","*":"ASTERISC","/":"SLASH","-":"HYPHENMINUS","+":"PLUS",".":"DOT",",":"COMMA",":":"COLON",";":"SEMI","'":"SINGLEQUOTE",'"':"DOUBLEQUOTE"},pt=new Set(Object.keys(dt)),vt=/\s/,Et=/[0-9]/,mt=/[A-Za-z0-9_]/i,yt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u(this,t),this.text=e,this.yieldWhitespace=n,this.yieldComments=r,this.position=0,this.line=1,this.column=1,this.eof=!1}return c(t,[{key:Symbol.iterator,value:function(){return this}},{key:"next",value:function(){var t=this.nextToken();return"EOF"===t.type?{done:!0}:{value:t,done:!1}}},{key:"nextToken",value:function(){var t=void 0,e=void 0;do{var n=this.column,r=this.line;for(e=this.position,t="";this.position<this.text.length&&vt.test(this.text[this.position]);)t+=this.text[this.position],"\n"===this.text[this.position]&&(this.column=0,this.line++),this.position++,this.column++;if(t.length){if(this.yieldWhitespace)return new lt("WHITESPACE",t,r,n)}else if((t=this.text[this.position])+this.text[e+1]!=="//"){if("{"!==t);else if(this.position=this.text.indexOf("}",e)+1,this.position<e&&(this.position=this.text.length),this.column+=this.position-e,this.yieldComments)return new lt("COMMENT",this.text.slice(e,this.position),r,n)}else if(this.position=this.text.indexOf("\n",e),this.column+=this.position-e,this.yieldComments)return new lt("COMMENT",this.text.slice(e,this.position),r,n)}while(e<this.position);var i=this.column,a=this.line;if(t=this.text[this.position],pt.has(t))return this.position++,this.column++,new lt(dt[t],t,a,i);if((t=this.readWhile(Et)).length)return new lt("INTEGER",+t,a,i);if((t=this.readWhile(mt)).length)return new lt(ft[t.toLowerCase()]||"IDENTIFIER",t,a,i);if(this.position>=this.text.length)return new lt("EOF","",a,i);throw new Error("Syntax Error: Could not read next token in line "+a+" column "+i+".")}},{key:"readWhile",value:function(t){for(var e="";this.position<this.text.length&&t.test(this.text[this.position]);)e+=this.text[this.position],this.position++,this.column++;return e}},{key:"remainingText",get:function(){return this.text.slice(this.position)}}]),t}(),wt=function(){function t(e){u(this,t),this.tokens=e,this.depth=0,this.forward()}return c(t,[{key:"forward",value:function(){this.currentToken=this.tokens.nextToken()}},{key:"eat",value:function(t){if(this.currentToken.type!==t)throw new Error("Syntax Error on line "+this.tokens.line+": Unexpected token "+this.currentToken+", was expecting "+t+".");this.forward()}},{key:"readToken",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.includes(this.currentToken.type)){var r=this.currentToken.value;return this.forward(),r}throw new Error("Syntax Error on line "+this.tokens.line+": Unexpected token "+this.currentToken+". Expected any of "+e)}},{key:"readExpression",value:function(){switch(this.currentToken.type){case"IDENTIFIER":return this.readCall();case"INTEGER":var t=+this.currentToken.value;return this.forward(),{type:"INTEGER",value:t};case st:return this.forward(),{type:st,expression:this.readExpression()};case"LPAREN":var e=this.readExpression();return this.eat("RPAREN"),e}}},{key:"readCall",value:function(){var t={type:"IDENTIFIER",identifier:this.currentToken.value,line:this.currentToken.line};return this.forward(),"LPAREN"===this.currentToken.type&&(this.forward(),"RPAREN"===this.currentToken.type?this.forward():(t.argument=this.readExpression(),this.eat("RPAREN"))),t}},{key:"readSequence",value:function(){var t=[],e=["ASTERISC","ELSE","EOF"];for(this.depth++;!e.includes(this.currentToken.type);)t.push(this.readStatement());return this.depth--,t}},{key:"readStatement",value:function(){var t={type:this.currentToken.type};switch(this.currentToken.type){case"IDENTIFIER":return this.readCall();case ut:return this.forward(),t.condition=this.readExpression(),this.eat("THEN"),t.sequence=this.readSequence(),"ELSE"===this.currentToken.type&&(this.forward(),t.alternative=this.readSequence()),this.eat("ASTERISC"),this.eat(ut),t;case ct:return this.forward(),t.condition=this.readExpression(),this.eat("DO"),t.sequence=this.readSequence(),this.eat("ASTERISC"),this.eat(ct),t;case"REPEAT":return this.forward(),this.currentToken.type===ct?(t.type=ct,this.forward(),t.condition=this.readExpression()):(t.count=this.readExpression(),this.eat("TIMES")),t.sequence=this.readSequence(),this.eat("ASTERISC"),this.eat("REPEAT"),t;case"PROGRAM":if(this.depth>1)throw new Error("Parse Error on line "+this.tokens.line+": Can't define program in nested context.");return this.forward(),t.sequence=this.readSequence(),this.eat("ASTERISC"),this.eat("PROGRAM"),t;case"ROUTINE":if(this.depth>1)throw new Error("Parse Error on line "+this.tokens.line+": Can't define routine in nested context.");return this.forward(),t.identifier=this.readToken("IDENTIFIER"),t.sequence=this.readSequence(),this.eat("ASTERISC"),this.eat("ROUTINE"),t}throw new Error("Parse Error on line "+this.tokens.line+": Unexpected token "+this.currentToken+".")}}]),t}(),gt={linksdrehen:"turnLeft",rechtsdrehen:"turnRight",schritt:"step","schrittzurück":"stepBackwards",hinlegen:"placeBlock",aufheben:"takeBlock",markesetzen:"placeMark","markelöschen":"takeMark",istwand:"isLookingAtEdge"},xt=new(function(){function t(e){u(this,t),this.runtime=e,this.routines=Object.create(null)}return c(t,[{key:"interrupt",value:function(){this._interrupted=!0}},{key:"run",value:function(){var t=s(o.mark(function t(e){var n,r,i;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new yt(e),r=new wt(n),i=r.readSequence(),this._interrupted=!1,t.next=6,this.visitSequence(i);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"visitSequence",value:function(){var t=s(o.mark(function t(e){var n,r,i,a,s,u;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,r=!1,i=void 0,t.prev=3,a=e[Symbol.iterator]();case 5:if(n=(s=a.next()).done){t.next=12;break}return u=s.value,t.next=9,this.visitStatement(u);case 9:n=!0,t.next=5;break;case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(3),r=!0,i=t.t0;case 18:t.prev=18,t.prev=19,!n&&a.return&&a.return();case 21:if(t.prev=21,!r){t.next=24;break}throw i;case 24:return t.finish(21);case 25:return t.finish(18);case 26:case"end":return t.stop()}},t,this,[[3,14,18,26],[19,,21,25]])}));return function(e){return t.apply(this,arguments)}}()},{key:"visitStatement",value:function(){var t=s(o.mark(function t(e){var n,r;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.type,t.next="IDENTIFIER"===t.t0?3:t.t0===ut?15:t.t0===ct?26:"REPEAT"===t.t0?34:"PROGRAM"===t.t0?45:"ROUTINE"===t.t0?48:50;break;case 3:if(!this._interrupted){t.next=5;break}return t.abrupt("return");case 5:if(!(e.identifier in this.routines)){t.next=12;break}if(!(this.depth>10)){t.next=8;break}throw new Error("RunTime Error: Maximum recursion depth (10) exceeded.");case 8:return t.next=10,this.visitSequence(this.routines[e.identifier]);case 10:t.next=14;break;case 12:return t.next=14,this.runtime.execute(e.identifier,e.line);case 14:return t.abrupt("break",51);case 15:return t.next=17,this.visitExpression(e.condition);case 17:if(!t.sent){t.next=22;break}return t.next=20,this.visitSequence(e.sequence);case 20:t.next=25;break;case 22:if(!e.alternative){t.next=25;break}return t.next=25,this.visitSequence(e.alternative);case 25:return t.abrupt("break",51);case 26:return t.next=28,this.visitExpression(e.condition);case 28:if(!t.sent){t.next=33;break}return t.next=31,this.visitSequence(e.sequence);case 31:t.next=26;break;case 33:return t.abrupt("break",51);case 34:return t.next=36,this.visitExpression(e.count);case 36:n=t.sent,r=0;case 38:if(!(r<n)){t.next=44;break}return t.next=41,this.visitSequence(e.sequence);case 41:r++,t.next=38;break;case 44:return t.abrupt("break",51);case 45:return t.next=47,this.visitSequence(e.sequence);case 47:return t.abrupt("break",51);case 48:return this.routines[e.identifier]=e.sequence,t.abrupt("break",51);case 50:throw new Error("Unimplemented statement type "+e.type);case 51:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"visitExpression",value:function(){var t=s(o.mark(function t(e){return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.type,t.next="INTEGER"===t.t0?3:"IDENTIFIER"===t.t0?4:t.t0===st?5:8;break;case 3:return t.abrupt("return",+e.value);case 4:return t.abrupt("return",this.runtime.evaluate(e.identifier));case 5:return t.next=7,this.visitExpression(e.expression);case 7:return t.abrupt("return",!t.sent);case 8:throw new Error("Unimplemented expression type");case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}())({execute:function(){var t=s(o.mark(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,St;case 2:if(Rt){t.next=4;break}return t.abrupt("return");case 4:if(It(e,n),Dt(e),Mt(),!Tt){t.next=10;break}return t.next=10,Nt(bt);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),evaluate:Dt}),kt=void 0,bt=100,Tt=!0,Rt=!1,Lt=!1,St=Promise.resolve(),At=d,Ot=d,It=d,Nt=function(t){return new Promise(function(e){Ot=e,setTimeout(e,t)})};function Pt(t){kt=t,Mt()}function Mt(){!function(t){var e=t.width,n=t.length,r=t.height,i=t.player,a=t.tiles,o=t.seed,s=.5*(e+n)*(q+2*W),u=.5*(e+n)*(j+1*W)+r*F+K;Y.width!==s&&(Y.width=s),Y.height!==u&&(Y.height=u),Z.clearRect(0,0,Y.width,Y.height),V&&L(o);for(var c=.5*(n-1)*(q+2*W),h=void 0,l=void 0,f=void 0,d=0;d<e;++d)for(var p=0;p<n;++p){h=.5*(-p+d)*(q+2*W)+W+c,l=.5*(p+d)*(j+1*W)-.5*W+r*F+K;var v=a[d*n+p];if(f=0,V&&(f+=5*Q*O(d/10,p/10)+Q*O(d/3,p/3)),B.floor.draw(Z,h,l-f),f+=B.floor.height+z,v.cuboid)B.cuboid.draw(Z,h,l-f),f+=B.cuboid.height+z;else{for(var E=0;E<v.blocks;++E)B.block.draw(Z,h,l-f),f+=B.block.height+z;v.mark&&(B.mark.draw(Z,h,l-f),f+=B.mark.height+z)}J&&i.x===d&&i.y===p&&B["player_"+H[i.orientation]].draw(Z,h,l-f)}}(kt)}function Ct(t){bt=t}function _t(){Lt||(Lt=!0,St=new Promise(function(t){return At=t}))}function Ht(){Lt&&(Lt=!1,Ot(),At())}var Ut=function(){var t=s(o.mark(function t(){var e;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Rt){t.next=2;break}return t.abrupt("return");case 2:if(!Lt){t.next=12;break}return e=Tt,Tt=!1,Ht(),t.next=8,St;case 8:_t(),Tt=e,t.next=13;break;case 12:Ot();case 13:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}();function Dt(t){var e=gt[t.toLowerCase()];if(!e)throw new Error("RunTime Error: "+t+" is not defined.");return kt[e]()}var Bt=function(){var t=s(o.mark(function t(e){return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Tt=!0,Rt=!0,Ht(),t.next=5,xt.run(e);case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}();var Gt=Object.create(null);Gt[ht.IDENTIFIER]="identifier",Gt[ht.INTEGER]="number",Gt[ht.COMMENT]="comment",[ht.NOT,ht.IF,ht.THEN,ht.ELSE,ht.WHILE,ht.DO,ht.REPEAT,ht.TIMES,ht.PROGRAM,ht.ROUTINE].forEach(function(t){return Gt[t]="keyword"}),[ht.LPAREN,ht.RPAREN,ht.LBRACKET,ht.RBRACKET,ht.LBRACE,ht.RBRACE,ht.LESS,ht.GREATER,ht.EQUALS,ht.ASTERISC,ht.SLASH,ht.HYPHENMINUS,ht.PLUS,ht.DOT,ht.COMMA,ht.COLON,ht.SEMI,ht.SINGLEQUOTE,ht.DOUBLEQUOTE].forEach(function(t){return Gt[t]="punctuation"});var qt=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"    ";u(this,t),this.indentation=r,this.unindenRegex=new RegExp("^"+r.split("").join("?")+"?","gm"),this.scrollbox=e.getElementsByClassName("editor-scrollbox")[0],this.highlighted=e.getElementsByClassName("editor-highlight")[0];var i=this.textarea=e.getElementsByClassName("editor-textarea")[0],a=this.caretLayer=e.getElementsByClassName("editor-caret-layer")[0];this.beforeCaret=a.appendChild(document.createElement("span")),this.caret=a.appendChild(document.createElement("span")),this.caret.classList.add("editor-caret"),this.selection=a.appendChild(document.createElement("span")),this.selection.classList.add("editor-selection"),i.addEventListener("keydown",function(t){"Tab"!==t.key&&9!==t.keyCode||(t.preventDefault(),t.shiftKey?n.unindent():n.indent())}),i.addEventListener("input",this.update.bind(this));var o=this.updateCaret.bind(this),s=function(){return setTimeout(o,0)};i.addEventListener("keypress",s),i.addEventListener("keydown",s),i.addEventListener("mousedown",function(){this.addEventListener("mousemove",s),s()}),i.addEventListener("mouseup",function(){this.removeEventListener("mousemove",s),s()}),this.update()}return c(t,[{key:"update",value:function(){this.highlighted.innerHTML=function(t){var e="",n=1,r=function(){return'</span></span><span class="line"><span class="lineno">'+ ++n+"</span><span>"},i=new yt(t,!0,!0);try{var a=!0,o=!1,s=void 0;try{for(var u,c=i[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;h.type in Gt?e+='<span class="token '+Gt[h.type]+'">'+h.value+"</span>":e+=h.value.replace(/ /g,"·").replace(/\n/g,r)}}catch(t){o=!0,s=t}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}}catch(t){e+=i.remainingText.replace(/\n/g,r)}return'<span class="line"><span class="lineno">1</span><span>'+e+"</span></span>"}(this.textarea.value),this.textarea.style.height=this.highlighted.offsetHeight+"px",this.updateCaret()}},{key:"updateCaret",value:function(){var t=this,e=this.textarea,n=e.value,r=e.selectionDirection,i=e.selectionEnd,a=e.selectionStart;this.beforeCaret.innerHTML=n.slice(0,a),this.selection.innerHTML=n.slice(a,i),this.caret.insertAdjacentElement("forward"===r?"beforebegin":"afterend",this.selection),this.caret.classList.remove("blink"),requestAnimationFrame(function(){return t.caret.classList.add("blink")})}},{key:"markLine",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=this.highlighted.getElementsByClassName("current")[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){i.value.classList.remove("current")}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}var o=this.highlighted.children[t-1];o&&o.classList.add("current")}},{key:"indent",value:function(){var t=this.textarea,e=t.value,n=t.selectionStart,r=t.selectionEnd,i=t.selectionDirection;if(e.slice(n,r).includes("\n")){var a=e.lastIndexOf("\n",n-1)+1,o=e.indexOf("\n",r);o<0&&(o=e.length);var s=e.slice(a,o).replace(/^/gm,this.indentation);this.textarea.value=e.slice(0,a)+s+e.slice(o),this.textarea.selectionStart=n+this.indentation.length,this.textarea.selectionEnd=a+s.length-(o-r),this.textarea.selectionDirection=i}else{var u=this.indentation;if("\t"!==u){var c=e.lastIndexOf("\n",n)+1,h=u.length-(n-c)%u.length;u=u.substr(0,h)}this.textarea.value=e.slice(0,n)+u+e.slice(r),this.textarea.selectionStart=this.textarea.selectionEnd=n+u.length}this.update()}},{key:"unindent",value:function(){var t=this.textarea,e=t.value,n=t.selectionStart,r=t.selectionEnd,i=t.selectionDirection,a=e.lastIndexOf("\n",n-1)+1,o=e.indexOf("\n",r);o<0&&(o=e.length);var s=null,u=e.slice(a,o).replace(this.unindenRegex,function(t){return null===s&&(s=t.length),""});this.textarea.value=e.slice(0,a)+u+e.slice(o),this.textarea.selectionStart=Math.max(a,n-s),this.textarea.selectionEnd=Math.max(a+u.lastIndexOf("\n")+1,r-o+a+u.length),this.textarea.selectionDirection=i,this.update()}},{key:"value",get:function(){return this.textarea.value},set:function(t){this.textarea.value=t,this.update()}}]),t}();function jt(t){return function(t){return new Promise(function(e){var n=new FileReader;n.onload=function(){e(n.result)},n.readAsText(t)})}(t).then(Ft)}function Ft(t){for(var e=t.split(/\s+/),n=e.slice(1,7).map(function(t){return+t}),r=h(n,6),i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],c=r[5],l=[],f=0;f<i*a;f++){var d=7+(o+1)*f,p=e.slice(d,d+o+1),v={blocks:p.filter(function(t){return"z"===t}).length,mark:"m"===p[p.length-1]};p.includes("q")&&(v.cuboid=!0),l.push(v)}return new ot(i,a,o,0,{x:s,y:u,orientation:c},l)}var Wt={ArrowLeft:"LinksDrehen",a:"LinksDrehen",ArrowRight:"RechtsDrehen",d:"RechtsDrehen",ArrowUp:"Schritt",w:"Schritt",ArrowDown:"SchrittZurück",s:"SchrittZurück",h:"Hinlegen",H:"Aufheben",m:"MarkeSetzen",M:"MarkeLöschen"},zt=void 0,Qt=void 0,Kt=void 0,Yt=void 0,Zt=void 0,Jt=void 0;function Vt(){var t,e,n;t=+Qt.value,e=+Kt.value,n=+Yt.value,Pt(new ot(t,e,n))}function Xt(){jt(Zt.files[0]).then(Pt)}function $t(t,e,n){e.addEventListener(t,function(t){t.preventDefault(),n.apply(this,arguments)})}function te(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];e.map(function(t){return t.removeAttribute("disabled")})}function ee(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];e.map(function(t){return t.setAttribute("disabled","disabled")})}function ne(){Qt=v("width-input"),Kt=v("length-input"),Yt=v("height-input"),Zt=v("file-input"),Jt=v("status-text");var t,e=v("world-simulation-speed"),n=v("world-show-player"),r=v("world-show-flat");$t("submit",v("world-create-form"),Vt),$t("submit",v("world-load-form"),Xt),$t("change",Zt,Xt),$t("change",n,function(){X(n.checked),Mt()}),X(n.checked),$t("change",r,function(){$(!r.checked),Mt()}),$(!r.checked),$t("change",e,function(){Ct(Math.pow(10,4-e.value))}),Ct(Math.pow(10,4-e.value)),Vt(),addEventListener("keydown",(t=s(o.mark(function t(e){var n;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.defaultPrevented||e.target instanceof HTMLTextAreaElement)){t.next=2;break}return t.abrupt("return");case 2:if(!(n=Wt[e.key])){t.next=18;break}if(e.preventDefault(),!Rt){t.next=7;break}return t.abrupt("return");case 7:return t.prev=7,t.next=10,Dt(n),void Mt();case 10:Jt.innerHTML="",Jt.classList.remove("status-error"),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(7),Jt.innerHTML=t.t0.message,Jt.classList.add("status-error");case 18:case"end":return t.stop()}},t,this,[[7,14]])})),function(e){return t.apply(this,arguments)}))}function re(){var t=v("run-button"),e=v("stop-button"),n=v("step-button"),r=v("unpause-button"),i=v("pause-button");ee(e,n,i,r),$t("click",t,s(o.mark(function a(){return o.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return ee(t),te(e,n,i),Jt.innerHTML="",Jt.classList.remove("status-error"),Jt.innerHTML="RUNNING.",a.prev=5,a.next=8,Bt(zt.value);case 8:a.next=14;break;case 10:a.prev=10,a.t0=a.catch(5),Jt.innerHTML=a.t0.message,Jt.classList.add("status-error");case 14:return a.prev=14,te(t),ee(e,n,i,r),zt.markLine(),a.finish(14);case 19:case"end":return a.stop()}},a,this,[[5,10,14,19]])}))),$t("click",e,function(){xt.interrupt(),Rt=!1,Tt=!1,Ht(),Jt.innerHTML="STOPPED."}),$t("click",n,function(){Ut()}),$t("click",i,function(){_t(),Jt.innerHTML="PAUSED.",ee(i),te(r)}),$t("click",r,function(){Ht(),Jt.innerHTML="RUNNING.",ee(r),te(i)})}!function(){var t=s(o.mark(function t(){var e;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g();case 2:if(t.t0=t.sent.editor_theme,t.t0){t.next=5;break}t.t0="bright";case 5:return e=t.t0,v("editor-theme-stylesheet").href="css/editor-theme-"+e+".css",t.next=9,Promise.all([et(),m]);case 9:return zt=new qt(v("editor")),It=function(t,e){return zt.markLine(e)},ne(),re(),t.next=15,fetch("BOT.kdp").then(function(t){return t.text()});case 15:zt.value=t.sent;case 16:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()()}();
