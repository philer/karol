!function(){"use strict";var e,t=(function(e){!function(t){var n,r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag",c=t.regeneratorRuntime;if(c)e.exports=c;else{(c=t.regeneratorRuntime=e.exports).wrap=w;var h="suspendedStart",l="suspendedYield",f="executing",d="completed",p={},v={};v[o]=function(){return this};var E=Object.getPrototypeOf,m=E&&E(E(I([])));m&&m!==r&&i.call(m,o)&&(v=m);var y=b.prototype=x.prototype=Object.create(v);k.prototype=y.constructor=b,b.constructor=k,b[u]=k.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(y),e},c.awrap=function(e){return{__await:e}},T(R.prototype),R.prototype[s]=function(){return this},c.AsyncIterator=R,c.async=function(e,t,n,r){var i=new R(w(e,t,n,r));return c.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},T(y),y[u]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),p}}}function w(e,t,n,r){var i=t&&t.prototype instanceof x?t:x,a=Object.create(i.prototype),o=new O(r||[]);return a._invoke=function(e,t,n){var r=h;return function(i,a){if(r===f)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw a;return N()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=L(o,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var u=g(e,t,n);if("normal"===u.type){if(r=n.done?d:l,u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function g(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function x(){}function k(){}function b(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function R(e){var t;this._invoke=function(n,r){function a(){return new Promise(function(t,a){!function t(n,r,a,o){var s=g(e[n],e,r);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,a,o)},function(e){t("throw",e,a,o)}):Promise.resolve(c).then(function(e){u.value=e,a(u)},o)}o(s.arg)}(n,r,t,a)})}return t=t?t.then(a,a):a()}}function L(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,L(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=g(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function I(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}return{next:N}}function N(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())}(e={exports:{}},e.exports),e.exports),n=function(){return this}()||Function("return this")(),r=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=r&&n.regeneratorRuntime;n.regeneratorRuntime=void 0;var a=t;if(r)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}var o=a,s=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}},u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(e){return Array.isArray(e)?e:Array.from(e)},f=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};function d(){}var p,v=document.getElementById.bind(document),E=(document.getElementsByClassName.bind(document),document.getElementsByTagName.bind(document),URL?function(e){return new URL(e,document.location).href}:function(e){var t=document.createElement("a");return t.href=e,t.href}),m="loading"===document.readyState?(p="DOMContentLoaded",new Promise(function(e){return addEventListener(p,e)})):Promise.resolve(),y=function(e,t){return Math.floor(Math.random()*Math.floor(t))+e},w=(function(){function e(t){u(this,e),this._seed=t%2147483647,this._seed<=0&&(this._seed+=2147483646)}c(e,[{key:"next",value:function(){return this._seed=16807*this._seed%2147483647}},{key:"nextFloat",value:function(){return(this.next()-1)/2147483646}}])}(),Object.create(null));function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"config.js";return(e=E(e))in w?Promise.resolve(w[e]):new Promise(function(t,n){var r=document.createElement("script");r.onload=function(){t(w[r.src]),r.remove()},r.onerror=function(){n(),r.remove()},document.head.appendChild(r),r.src=e})}function x(e,t,n){this.x=e,this.y=t,this.z=n}window.config=function(e){w[document.currentScript.src]=Object.freeze(e)},x.prototype.dot2=function(e,t){return this.x*e+this.y*t},x.prototype.dot3=function(e,t,n){return this.x*e+this.y*t+this.z*n};var k=[new x(1,1,0),new x(-1,1,0),new x(1,-1,0),new x(-1,-1,0),new x(1,0,1),new x(-1,0,1),new x(1,0,-1),new x(-1,0,-1),new x(0,1,1),new x(0,-1,1),new x(0,1,-1),new x(0,-1,-1)],b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],T=new Array(512),R=new Array(512);function L(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n;n=1&t?b[t]^255&e:b[t]^e>>8&255,T[t]=T[t+256]=n,R[t]=R[t+256]=k[n%12]}}L(0);var S=.5*(Math.sqrt(3)-1),A=(3-Math.sqrt(3))/6;function O(e,t){var n,r,i=(e+t)*S,a=Math.floor(e+i),o=Math.floor(t+i),s=(a+o)*A,u=e-a+s,c=t-o+s;u>c?(n=1,r=0):(n=0,r=1);var h=u-n+A,l=c-r+A,f=u-1+2*A,d=c-1+2*A,p=R[(a&=255)+T[o&=255]],v=R[a+n+T[o+r]],E=R[a+1+T[o+1]],m=.5-u*u-c*c,y=.5-h*h-l*l,w=.5-f*f-d*d;return 70*((m<0?0:(m*=m)*m*p.dot2(u,c))+(y<0?0:(y*=y)*y*v.dot2(h,l))+(w<0?0:(w*=w)*w*E.dot2(f,d)))}var I,N,P=(I=s(o.mark(function e(){return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m;case 2:Y=document.getElementById("world-canvas"),(Z=Y.getContext("2d")).mozImageSmoothingEnabled=!1,Z.webkitImageSmoothingEnabled=!1,Z.msImageSmoothingEnabled=!1,Z.imageSmoothingEnabled=!1;case 8:case"end":return e.stop()}},e,this)})),function(){return I.apply(this,arguments)}),M=(N=s(o.mark(function e(t){var n,r,i,a,s,u,c,l,f,d,p,v,E,m,y,w,x,k,b,T;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.tile_theme+"/",r=(t.player_theme||t.tile_theme)+"/",e.next=4,Promise.all([n+"theme.js",r+"theme.js",C+"theme.js"].map(g));case 4:for(i=e.sent,a=h(i,3),s=a[0],u=a[1],c=a[2],l=Object.assign({},_,s),q=l.tile_width,j=l.tile_depth,F=l.block_height,W=l.tile_gap,z=l.tile_gap_z,Q=l.noise_amplifier,K=u.player_height||l.player_height,f=!0,d=!1,p=void 0,e.prev=20,v=U[Symbol.iterator]();!(f=(E=v.next()).done);f=!0)m=E.value,u.sprites.hasOwnProperty(m)?B[m]=ne(m,u,r):s.sprites.hasOwnProperty(m)?B[m]=ne(m,s,n):B[m]=ne(m,c,C);e.next=28;break;case 24:e.prev=24,e.t0=e.catch(20),d=!0,p=e.t0;case 28:e.prev=28,e.prev=29,!f&&v.return&&v.return();case 31:if(e.prev=31,!d){e.next=34;break}throw p;case 34:return e.finish(31);case 35:return e.finish(28);case 36:for(y=!0,w=!1,x=void 0,e.prev=39,k=D[Symbol.iterator]();!(y=(b=k.next()).done);y=!0)T=b.value,s.sprites.hasOwnProperty(T)?B[T]=ne(T,s,n):B[T]=ne(T,c,C);e.next=47;break;case 43:e.prev=43,e.t1=e.catch(39),w=!0,x=e.t1;case 47:e.prev=47,e.prev=48,!y&&k.return&&k.return();case 50:if(e.prev=50,!w){e.next=53;break}throw x;case 53:return e.finish(50);case 54:return e.finish(47);case 55:return e.abrupt("return",Promise.all(Object.values(B).map(function(e){return e.load()})));case 56:case"end":return e.stop()}},e,this,[[20,24,28,36],[29,,31,35],[39,43,47,55],[48,,50,54]])})),function(e){return N.apply(this,arguments)}),C="img/simple/",_={tile_width:64,tile_depth:32,block_height:16,player_height:128,tile_gap:2,tile_gap_z:1,noise_amplifier:1},H=["south","east","north","west"],U=H.map(function(e){return"player_"+e}),D=["floor","block","mark","cuboid"],B={},G=Object.create(null),q=void 0,j=void 0,F=void 0,W=void 0,z=void 0,Q=void 0,K=void 0,Y=void 0,Z=void 0,J=!0,V=!0;function X(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];J=e}function $(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];V=e}var ee,te=(ee=s(o.mark(function e(){return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Promise,e.t1=M,e.next=4,g();case 4:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=P(),e.t5=[e.t3,e.t4],e.next=10,e.t0.all.call(e.t0,e.t5);case 10:case"end":return e.stop()}},e,this)})),function(){return ee.apply(this,arguments)});function ne(e,t,n){var r=void 0,i=void 0;try{var a=l(t.images[t.sprites[e]]);r=a[0],i=a.slice(1)}catch(t){return void console.warn("Bad theme config: No image for sprite '"+e+"' in "+n)}return i.length?new(Function.prototype.bind.apply(ie,[null].concat([n+r],f(i)))):new re(n+r)}var re=function(){function e(t){u(this,e),this.imagePath=t}return c(e,[{key:"load",value:function(){var e=s(o.mark(function e(){var t;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae(this.imagePath);case 2:this._image=e.sent,t=q/this._image.width,this._scaledWidth=q,this._scaledHeight=t*this._image.height,this.height=this._scaledHeight-j;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"draw",value:function(e,t,n){e.drawImage(this._image,t,n-this.height,this._scaledWidth,this._scaledHeight)}}]),e}(),ie=function(){function e(t,n,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;u(this,e),this.imagePath=t,this._crop={x:n,y:r,width:i,height:a};var c=q/i;this._scaledWidth=q,this._scaledHeight=c*a,this.height=this._scaledHeight-j,this.xOffset=o,this.yOffset=s}return c(e,[{key:"load",value:function(){var e=s(o.mark(function e(){return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae(this.imagePath);case 2:this._image=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"draw",value:function(e,t,n){e.drawImage(this._image,this._crop.x,this._crop.y,this._crop.width,this._crop.height,t+this.xOffset,n-this.height-this.yOffset,this._scaledWidth,this._scaledHeight)}}]),e}();function ae(e){return e in G?G[e]:G[e]=new Promise(function(t){var n=new Image;n.onload=function(){t(n)},n.src=e})}var oe=function(){function e(t,n,r,i,a,o){u(this,e),this.width=t,this.length=n,this.height=r,this.seed=i||y(1<<31,-(1<<31)),this.player=a||{x:0,y:0,orientation:0},this.tiles=o||Array.from({length:t*n},function(){return{blocks:0,mark:!1}})}return c(e,[{key:"contains",value:function(e,t){return e>=0&&t>=0&&e<this.width&&t<this.length}},{key:"isLookingAtEdge",value:function(){return!this.contains.apply(this,f(e.move(this.player)))}},{key:"step",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.tiles[this.player.x*this.length+this.player.y].blocks,i=e.move(this.player,t,n),a=h(i,2),o=a[0],s=a[1];if(!this.contains(o,s))throw new Error("invalid move: out of world");var u=this.tiles[o*this.length+s];if(1<Math.abs(r-u.blocks))throw new Error("invalid move: jump too high");if(u.cuboid)throw new Error("invalid move: cuboid");var c=[o,s];this.player.x=c[0],this.player.y=c[1]}},{key:"stepBackwards",value:function(){this.step(-1)}},{key:"turnLeft",value:function(){this.player.orientation=(this.player.orientation+1)%4}},{key:"turnRight",value:function(){this.player.orientation=(this.player.orientation+3)%4}},{key:"placeBlock",value:function(){var t=e.move(this.player),n=h(t,2),r=n[0],i=n[1];if(!this.contains(r,i))throw new Error("invalid action: out of world");var a=this.tiles[r*this.length+i];if(a.cuboid)throw new Error("invalid action: block on cuboid");if(a.blocks>=this.height)throw new Error("invalid action: building too high");a.blocks++}},{key:"takeBlock",value:function(){var t=e.move(this.player),n=h(t,2),r=n[0],i=n[1];if(!this.contains(r,i))throw new Error("invalid action: out of world");var a=this.tiles[r*this.length+i];if(a.blocks<=0)throw new Error("invalid action: no blocks");a.blocks--}},{key:"placeMark",value:function(){var e=this.tiles[this.player.x*this.length+this.player.y];if(e.mark)throw new Error("invalid action: already has a mark");e.mark=!0}},{key:"takeMark",value:function(){var e=this.tiles[this.player.x*this.length+this.player.y];if(!e.mark)throw new Error("invalid action: no mark");e.mark=!1}}],[{key:"move",value:function(e){var t=e.x,n=e.y,r=e.orientation,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(r){case 0:t+=a,n+=i;break;case 1:t+=i,n+=a;break;case 2:t-=a,n-=i;break;case 3:t-=i,n-=a}return[t,n]}}]),e}(),se="NOT",ue="IF",ce="WHILE",he=Object.freeze({IDENTIFIER:"IDENTIFIER",INTEGER:"INTEGER",NOT:se,IF:ue,THEN:"THEN",ELSE:"ELSE",WHILE:ce,DO:"DO",REPEAT:"REPEAT",TIMES:"TIMES",PROGRAM:"PROGRAM",ROUTINE:"ROUTINE",LPAREN:"LPAREN",RPAREN:"RPAREN",LBRACKET:"LBRACKET",RBRACKET:"RBRACKET",LBRACE:"LBRACE",RBRACE:"RBRACE",LESS:"LESS",GREATER:"GREATER",EQUALS:"EQUALS",ASTERISC:"ASTERISC",SLASH:"SLASH",HYPHENMINUS:"HYPHENMINUS",PLUS:"PLUS",DOT:"DOT",COMMA:"COMMA",COLON:"COLON",SEMI:"SEMI",SINGLEQUOTE:"SINGLEQUOTE",DOUBLEQUOTE:"DOUBLEQUOTE",WHITESPACE:"WHITESPACE",COMMENT:"COMMENT",EOF:"EOF"}),le=function(){function e(t,n,r,i){u(this,e),this.type=t,this.value=n,this.line=r,this.column=i}return c(e,[{key:"toString",value:function(){return this.type+"("+this.value+")"}}]),e}(),fe={wenn:ue,if:ue,dann:"THEN",then:"THEN",sonst:"ELSE",else:"ELSE",solange:ce,while:ce,tue:"DO",do:"DO",nicht:se,not:se,wiederhole:"REPEAT",repeat:"REPEAT",mal:"TIMES",times:"TIMES",programm:"PROGRAM",program:"PROGRAM",anweisung:"ROUTINE",routine:"ROUTINE"},de={"(":"LPAREN",")":"RPAREN","[":"LBRACKET","]":"RBRACKET","{":"LBRACE","}":"RBRACE","<":"LESS",">":"GREATER","=":"EQUALS","*":"ASTERISC","/":"SLASH","-":"HYPHENMINUS","+":"PLUS",".":"DOT",",":"COMMA",":":"COLON",";":"SEMI","'":"SINGLEQUOTE",'"':"DOUBLEQUOTE"},pe=new Set(Object.keys(de)),ve=/\s/,Ee=/[0-9]/,me=/[A-Za-z0-9_]/i,ye=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u(this,e),this.text=t,this.yieldWhitespace=n,this.yieldComments=r,this.position=0,this.line=1,this.column=1,this.eof=!1}return c(e,[{key:Symbol.iterator,value:function(){return this}},{key:"next",value:function(){var e=this.nextToken();return"EOF"===e.type?{done:!0}:{value:e,done:!1}}},{key:"nextToken",value:function(){var e=void 0,t=void 0;do{var n=this.column,r=this.line;for(t=this.position,e="";this.position<this.text.length&&ve.test(this.text[this.position]);)e+=this.text[this.position],"\n"===this.text[this.position]&&(this.column=0,this.line++),this.position++,this.column++;if(e.length){if(this.yieldWhitespace)return new le("WHITESPACE",e,r,n)}else if((e=this.text[this.position])+this.text[t+1]!=="//"){if("{"!==e);else if(this.position=this.text.indexOf("}",t)+1,this.column+=this.position-t,this.yieldComments)return new le("COMMENT",this.text.slice(t,this.position),r,n)}else if(this.position=this.text.indexOf("\n",t),this.column+=this.position-t,this.yieldComments)return new le("COMMENT",this.text.slice(t,this.position),r,n)}while(t<this.position);var i=this.column,a=this.line;if(e=this.text[this.position],pe.has(e))return this.position++,this.column++,new le(de[e],e,a,i);if((e=this.readWhile(Ee)).length)return new le("INTEGER",+e,a,i);if((e=this.readWhile(me)).length)return new le(fe[e.toLowerCase()]||"IDENTIFIER",e,a,i);if(this.position>=this.text.length)return new le("EOF","",a,i);throw new Error("Syntax Error: Could not read next token in line "+a+" column "+i+".")}},{key:"readWhile",value:function(e){for(var t="";this.position<this.text.length&&e.test(this.text[this.position]);)t+=this.text[this.position],this.position++,this.column++;return t}},{key:"remainingText",get:function(){return this.text.slice(this.position)}}]),e}(),we=function(){function e(t){u(this,e),this.tokens=t,this.depth=0,this.forward()}return c(e,[{key:"forward",value:function(){this.currentToken=this.tokens.nextToken()}},{key:"eat",value:function(e){if(this.currentToken.type!==e)throw new Error("Syntax Error on line "+this.tokens.line+": Unexpected token "+this.currentToken+", was expecting "+e+".");this.forward()}},{key:"readToken",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.includes(this.currentToken.type)){var r=this.currentToken.value;return this.forward(),r}throw new Error("Syntax Error on line "+this.tokens.line+": Unexpected token "+this.currentToken+". Expected any of "+t)}},{key:"readExpression",value:function(){switch(this.currentToken.type){case"IDENTIFIER":return this.readCall();case"INTEGER":var e=+this.currentToken.value;return this.forward(),{type:"INTEGER",value:e};case se:return this.forward(),{type:se,expression:this.readExpression()};case"LPAREN":var t=this.readExpression();return this.eat("RPAREN"),t}}},{key:"readCall",value:function(){var e={type:"IDENTIFIER",identifier:this.currentToken.value,line:this.currentToken.line};return this.forward(),"LPAREN"===this.currentToken.type&&(this.forward(),"RPAREN"===this.currentToken.type?this.forward():(e.argument=this.readExpression(),this.eat("RPAREN"))),e}},{key:"readSequence",value:function(){var e=[],t=["ASTERISC","ELSE","EOF"];for(this.depth++;!t.includes(this.currentToken.type);)e.push(this.readStatement());return this.depth--,e}},{key:"readStatement",value:function(){var e={type:this.currentToken.type};switch(this.currentToken.type){case"IDENTIFIER":return this.readCall();case ue:return this.forward(),e.condition=this.readExpression(),this.eat("THEN"),e.sequence=this.readSequence(),"ELSE"===this.currentToken.type&&(this.forward(),e.alternative=this.readSequence()),this.eat("ASTERISC"),this.eat(ue),e;case ce:return this.forward(),e.condition=this.readExpression(),this.eat("DO"),e.sequence=this.readSequence(),this.eat("ASTERISC"),this.eat(ce),e;case"REPEAT":return this.forward(),this.currentToken.type===ce?(e.type=ce,this.forward(),e.condition=this.readExpression()):(e.count=this.readExpression(),this.eat("TIMES")),e.sequence=this.readSequence(),this.eat("ASTERISC"),this.eat("REPEAT"),e;case"PROGRAM":if(this.depth>1)throw new Error("Parse Error on line "+this.tokens.line+": Can't define program in nested context.");return this.forward(),e.sequence=this.readSequence(),this.eat("ASTERISC"),this.eat("PROGRAM"),e;case"ROUTINE":if(this.depth>1)throw new Error("Parse Error on line "+this.tokens.line+": Can't define routine in nested context.");return this.forward(),e.identifier=this.readToken("IDENTIFIER"),e.sequence=this.readSequence(),this.eat("ASTERISC"),this.eat("ROUTINE"),e}throw new Error("Parse Error on line "+this.tokens.line+": Unexpected token "+this.currentToken+".")}}]),e}(),ge={linksdrehen:"turnLeft",rechtsdrehen:"turnRight",schritt:"step","schrittzurück":"stepBackwards",hinlegen:"placeBlock",aufheben:"takeBlock",markesetzen:"placeMark","markelöschen":"takeMark",istwand:"isLookingAtEdge"},xe=new(function(){function e(t){u(this,e),this.runtime=t,this.routines=Object.create(null)}return c(e,[{key:"interrupt",value:function(){this._interrupted=!0}},{key:"run",value:function(){var e=s(o.mark(function e(t){var n,r,i;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ye(t),r=new we(n),i=r.readSequence(),this._interrupted=!1,e.next=6,this.visitSequence(i);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"visitSequence",value:function(){var e=s(o.mark(function e(t){var n,r,i,a,s,u;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,i=void 0,e.prev=3,a=t[Symbol.iterator]();case 5:if(n=(s=a.next()).done){e.next=12;break}return u=s.value,e.next=9,this.visitStatement(u);case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,i=e.t0;case 18:e.prev=18,e.prev=19,!n&&a.return&&a.return();case 21:if(e.prev=21,!r){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}));return function(t){return e.apply(this,arguments)}}()},{key:"visitStatement",value:function(){var e=s(o.mark(function e(t){var n,r;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="IDENTIFIER"===e.t0?3:e.t0===ue?15:e.t0===ce?26:"REPEAT"===e.t0?34:"PROGRAM"===e.t0?45:"ROUTINE"===e.t0?48:50;break;case 3:if(!this._interrupted){e.next=5;break}return e.abrupt("return");case 5:if(!(t.identifier in this.routines)){e.next=12;break}if(!(this.depth>10)){e.next=8;break}throw new Error("RunTime Error: Maximum recursion depth (10) exceeded.");case 8:return e.next=10,this.visitSequence(this.routines[t.identifier]);case 10:e.next=14;break;case 12:return e.next=14,this.runtime.execute(t.identifier,t.line);case 14:return e.abrupt("break",51);case 15:return e.next=17,this.visitExpression(t.condition);case 17:if(!e.sent){e.next=22;break}return e.next=20,this.visitSequence(t.sequence);case 20:e.next=25;break;case 22:if(!t.alternative){e.next=25;break}return e.next=25,this.visitSequence(t.alternative);case 25:return e.abrupt("break",51);case 26:return e.next=28,this.visitExpression(t.condition);case 28:if(!e.sent){e.next=33;break}return e.next=31,this.visitSequence(t.sequence);case 31:e.next=26;break;case 33:return e.abrupt("break",51);case 34:return e.next=36,this.visitExpression(t.count);case 36:n=e.sent,r=0;case 38:if(!(r<n)){e.next=44;break}return e.next=41,this.visitSequence(t.sequence);case 41:r++,e.next=38;break;case 44:return e.abrupt("break",51);case 45:return e.next=47,this.visitSequence(t.sequence);case 47:return e.abrupt("break",51);case 48:return this.routines[t.identifier]=t.sequence,e.abrupt("break",51);case 50:throw new Error("Unimplemented statement type "+t.type);case 51:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"visitExpression",value:function(){var e=s(o.mark(function e(t){return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="INTEGER"===e.t0?3:"IDENTIFIER"===e.t0?4:e.t0===se?5:8;break;case 3:return e.abrupt("return",+t.value);case 4:return e.abrupt("return",this.runtime.evaluate(t.identifier));case 5:return e.next=7,this.visitExpression(t.expression);case 7:return e.abrupt("return",!e.sent);case 8:throw new Error("Unimplemented expression type");case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}())({execute:function(){var e=s(o.mark(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se;case 2:if(Re){e.next=4;break}return e.abrupt("return");case 4:if(Ie(t,n),De(t),Me(),!Te){e.next=10;break}return e.next=10,Ne(be);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),evaluate:De}),ke=void 0,be=100,Te=!0,Re=!1,Le=!1,Se=Promise.resolve(),Ae=d,Oe=d,Ie=d,Ne=function(e){return new Promise(function(t){Oe=t,setTimeout(t,e)})};function Pe(e){ke=e,Me()}function Me(){!function(e){var t=e.width,n=e.length,r=e.height,i=e.player,a=e.tiles,o=e.seed,s=.5*(t+n)*(q+2*W),u=.5*(t+n)*(j+1*W)+r*F+K;Y.width!==s&&(Y.width=s),Y.height!==u&&(Y.height=u),Z.clearRect(0,0,Y.width,Y.height),V&&L(o);for(var c=.5*(n-1)*(q+2*W),h=void 0,l=void 0,f=void 0,d=0;d<t;++d)for(var p=0;p<n;++p){h=.5*(-p+d)*(q+2*W)+W+c,l=.5*(p+d)*(j+1*W)-.5*W+r*F+K;var v=a[d*n+p];if(f=0,V&&(f+=5*Q*O(d/10,p/10)+Q*O(d/3,p/3)),B.floor.draw(Z,h,l-f),f+=B.floor.height+z,v.cuboid)B.cuboid.draw(Z,h,l-f),f+=B.cuboid.height+z;else{for(var E=0;E<v.blocks;++E)B.block.draw(Z,h,l-f),f+=B.block.height+z;v.mark&&(B.mark.draw(Z,h,l-f),f+=B.mark.height+z)}J&&i.x===d&&i.y===p&&B["player_"+H[i.orientation]].draw(Z,h,l-f)}}(ke)}function Ce(e){be=e}function _e(){Le||(Le=!0,Se=new Promise(function(e){return Ae=e}))}function He(){Le&&(Le=!1,Oe(),Ae())}var Ue=function(){var e=s(o.mark(function e(){var t;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Re){e.next=2;break}return e.abrupt("return");case 2:if(!Le){e.next=12;break}return t=Te,Te=!1,He(),e.next=8,Se;case 8:_e(),Te=t,e.next=13;break;case 12:Oe();case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}();function De(e){var t=ge[e.toLowerCase()];if(!t)throw new Error("RunTime Error: "+e+" is not defined.");return ke[t]()}var Be=function(){var e=s(o.mark(function e(t){return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Te=!0,Re=!0,He(),e.next=5,xe.run(t);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();var Ge=Object.create(null);Ge[he.IDENTIFIER]="identifier",Ge[he.INTEGER]="number",Ge[he.COMMENT]="comment",[he.NOT,he.IF,he.THEN,he.ELSE,he.WHILE,he.DO,he.REPEAT,he.TIMES,he.PROGRAM,he.ROUTINE].forEach(function(e){return Ge[e]="keyword"}),[he.LPAREN,he.RPAREN,he.LBRACKET,he.RBRACKET,he.LBRACE,he.RBRACE,he.LESS,he.GREATER,he.EQUALS,he.ASTERISC,he.SLASH,he.HYPHENMINUS,he.PLUS,he.DOT,he.COMMA,he.COLON,he.SEMI,he.SINGLEQUOTE,he.DOUBLEQUOTE].forEach(function(e){return Ge[e]="punctuation"});var qe=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"    ";u(this,e),this.indentation=r,this.unindenRegex=new RegExp("^"+r.split("").join("?")+"?","gm"),this.scrollbox=t.getElementsByClassName("editor-scrollbox")[0],this.highlighted=t.getElementsByClassName("editor-highlight")[0];var i=this.textarea=t.getElementsByClassName("editor-textarea")[0],a=this.caretLayer=t.getElementsByClassName("editor-caret-layer")[0];this.beforeCaret=a.appendChild(document.createElement("span")),this.caret=a.appendChild(document.createElement("span")),this.caret.classList.add("editor-caret"),this.selection=a.appendChild(document.createElement("span")),this.selection.classList.add("editor-selection"),i.addEventListener("keydown",function(e){"Tab"!==e.key&&9!==e.keyCode||(e.preventDefault(),e.shiftKey?n.unindent():n.indent())}),i.addEventListener("input",this.update.bind(this));var o=this.updateCaret.bind(this),s=function(){return setTimeout(o,0)};i.addEventListener("keypress",s),i.addEventListener("keydown",s),i.addEventListener("mousedown",function(){this.addEventListener("mousemove",s),s()}),i.addEventListener("mouseup",function(){this.removeEventListener("mousemove",s),s()}),this.update()}return c(e,[{key:"update",value:function(){this.highlighted.innerHTML=function(e){var t="",n=1,r=function(){return'</span></span><span class="line"><span class="lineno">'+ ++n+"</span><span>"},i=new ye(e,!0,!0);try{var a=!0,o=!1,s=void 0;try{for(var u,c=i[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;h.type in Ge?t+='<span class="token '+Ge[h.type]+'">'+h.value+"</span>":t+=h.value.replace(/ /g,"·").replace(/\n/g,r)}}catch(e){o=!0,s=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}}catch(e){t+=i.remainingText.replace(/\n/g,r)}return'<span class="line"><span class="lineno">1</span><span>'+t+"</span></span>"}(this.textarea.value),this.textarea.style.height=this.highlighted.offsetHeight+"px",this.updateCaret()}},{key:"updateCaret",value:function(){var e=this,t=this.textarea,n=t.value,r=t.selectionDirection,i=t.selectionEnd,a=t.selectionStart;this.beforeCaret.innerHTML=n.slice(0,a),this.selection.innerHTML=n.slice(a,i),this.caret.insertAdjacentElement("forward"===r?"beforebegin":"afterend",this.selection),this.caret.classList.remove("blink"),requestAnimationFrame(function(){return e.caret.classList.add("blink")})}},{key:"markLine",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=this.highlighted.getElementsByClassName("current")[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.classList.remove("current")}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}var o=this.highlighted.children[e-1];o&&o.classList.add("current")}},{key:"indent",value:function(){var e=this.textarea,t=e.value,n=e.selectionStart,r=e.selectionEnd,i=e.selectionDirection;if(t.slice(n,r).includes("\n")){var a=t.lastIndexOf("\n",n-1)+1,o=t.indexOf("\n",r);o<0&&(o=t.length);var s=t.slice(a,o).replace(/^/gm,this.indentation);this.textarea.value=t.slice(0,a)+s+t.slice(o),this.textarea.selectionStart=n+this.indentation.length,this.textarea.selectionEnd=a+s.length-(o-r),this.textarea.selectionDirection=i}else{var u=this.indentation;if("\t"!==u){var c=t.lastIndexOf("\n",n)+1,h=u.length-(n-c)%u.length;u=u.substr(0,h)}this.textarea.value=t.slice(0,n)+u+t.slice(r),this.textarea.selectionStart=this.textarea.selectionEnd=n+u.length}this.update()}},{key:"unindent",value:function(){var e=this.textarea,t=e.value,n=e.selectionStart,r=e.selectionEnd,i=e.selectionDirection,a=t.lastIndexOf("\n",n-1)+1,o=t.indexOf("\n",r);o<0&&(o=t.length);var s=null,u=t.slice(a,o).replace(this.unindenRegex,function(e){return null===s&&(s=e.length),""});this.textarea.value=t.slice(0,a)+u+t.slice(o),this.textarea.selectionStart=Math.max(a,n-s),this.textarea.selectionEnd=Math.max(a+u.lastIndexOf("\n")+1,r-o+a+u.length),this.textarea.selectionDirection=i,this.update()}},{key:"value",get:function(){return this.textarea.value},set:function(e){this.textarea.value=e,this.update()}}]),e}();function je(e){return function(e){return new Promise(function(t){var n=new FileReader;n.onload=function(){t(n.result)},n.readAsText(e)})}(e).then(Fe)}function Fe(e){for(var t=e.split(/\s+/),n=t.slice(1,7).map(function(e){return+e}),r=h(n,6),i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],c=r[5],l=[],f=0;f<i*a;f++){var d=7+(o+1)*f,p=t.slice(d,d+o+1),v={blocks:p.filter(function(e){return"z"===e}).length,mark:"m"===p[p.length-1]};p.includes("q")&&(v.cuboid=!0),l.push(v)}return new oe(i,a,o,0,{x:s,y:u,orientation:c},l)}var We={ArrowLeft:"LinksDrehen",a:"LinksDrehen",ArrowRight:"RechtsDrehen",d:"RechtsDrehen",ArrowUp:"Schritt",w:"Schritt",ArrowDown:"SchrittZurück",s:"SchrittZurück",h:"Hinlegen",H:"Aufheben",m:"MarkeSetzen",M:"MarkeLöschen"},ze=void 0,Qe=void 0,Ke=void 0,Ye=void 0,Ze=void 0,Je=void 0;function Ve(){var e,t,n;e=+Qe.value,t=+Ke.value,n=+Ye.value,Pe(new oe(e,t,n))}function Xe(){je(Ze.files[0]).then(Pe)}function $e(e,t,n){t.addEventListener(e,function(e){e.preventDefault(),n.apply(this,arguments)})}function et(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.map(function(e){return e.removeAttribute("disabled")})}function tt(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.map(function(e){return e.setAttribute("disabled","disabled")})}function nt(){Qe=v("width-input"),Ke=v("length-input"),Ye=v("height-input"),Ze=v("file-input"),Je=v("status-text");var e,t=v("world-simulation-speed"),n=v("world-show-player"),r=v("world-show-flat");$e("submit",v("world-create-form"),Ve),$e("submit",v("world-load-form"),Xe),$e("change",Ze,Xe),$e("change",n,function(){X(n.checked),Me()}),X(n.checked),$e("change",r,function(){$(!r.checked),Me()}),$(!r.checked),$e("change",t,function(){Ce(Math.pow(10,4-t.value))}),Ce(Math.pow(10,4-t.value)),Ve(),addEventListener("keydown",(e=s(o.mark(function e(t){var n;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.defaultPrevented||t.target instanceof HTMLTextAreaElement)){e.next=2;break}return e.abrupt("return");case 2:if(!(n=We[t.key])){e.next=18;break}if(t.preventDefault(),!Re){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,De(n),void Me();case 10:Je.innerHTML="",Je.classList.remove("status-error"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(7),Je.innerHTML=e.t0.message,Je.classList.add("status-error");case 18:case"end":return e.stop()}},e,this,[[7,14]])})),function(t){return e.apply(this,arguments)}))}function rt(){var e=v("run-button"),t=v("stop-button"),n=v("step-button"),r=v("unpause-button"),i=v("pause-button");tt(t,n,i,r),$e("click",e,s(o.mark(function a(){return o.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return tt(e),et(t,n,i),Je.innerHTML="",Je.classList.remove("status-error"),Je.innerHTML="RUNNING.",a.prev=5,a.next=8,Be(ze.value);case 8:a.next=14;break;case 10:a.prev=10,a.t0=a.catch(5),Je.innerHTML=a.t0.message,Je.classList.add("status-error");case 14:return a.prev=14,et(e),tt(t,n,i,r),ze.markLine(),a.finish(14);case 19:case"end":return a.stop()}},a,this,[[5,10,14,19]])}))),$e("click",t,function(){xe.interrupt(),Re=!1,Te=!1,He(),Je.innerHTML="STOPPED."}),$e("click",n,function(){Ue()}),$e("click",i,function(){_e(),Je.innerHTML="PAUSED.",tt(i),et(r)}),$e("click",r,function(){He(),Je.innerHTML="RUNNING.",tt(r),et(i)})}!function(){var e=s(o.mark(function e(){var t;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:if(e.t0=e.sent.editor_theme,e.t0){e.next=5;break}e.t0="bright";case 5:return t=e.t0,v("editor-theme-stylesheet").href="css/editor-theme-"+t+".css",e.next=9,Promise.all([te(),m]);case 9:return ze=new qe(v("editor")),Ie=function(e,t){return ze.markLine(t)},nt(),rt(),e.next=15,fetch("BOT.kdp").then(function(e){return e.text()});case 15:ze.value=e.sent;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()()}();
